name: 'Validate Study Inputs'
description: 'Validates study provisioning inputs'
inputs:
  study_title:
    description: 'Study title to validate'
    required: true
  lead_name:
    description: 'Study lead name to validate'
    required: true
  lead_github:
    description: 'GitHub username to validate'
    required: true
  target_date:
    description: 'Target date in YYYY-MM-DD format'
    required: true

outputs:
  repo_name:
    description: 'Generated repository name'
    value: ${{ steps.generate.outputs.repo_name }}

runs:
  using: 'composite'
  steps:
    - name: Validate date format
      shell: bash
      run: |
        if ! date -d "${{ inputs.target_date }}" >/dev/null 2>&1; then
          echo "❌ Invalid date format. Use YYYY-MM-DD"
          exit 1
        fi
        echo "✅ Date format validated"

    - name: Validate GitHub username
      shell: bash
      run: |
        if [[ ! "${{ inputs.lead_github }}" =~ ^[a-zA-Z0-9]([a-zA-Z0-9-]*[a-zA-Z0-9])?$ ]]; then
          echo "❌ Invalid GitHub username format"
          exit 1
        fi
        echo "✅ GitHub username validated"

    - name: Generate repository name
      id: generate
      shell: bash
      run: |
        # Generate repo name from title
        REPO_NAME=$(echo "study-${{ inputs.study_title }}" | tr '[:upper:]' '[:lower:]' | sed 's/[^a-z0-9-]/-/g' | sed 's/--*/-/g')
        echo "repo_name=$REPO_NAME" >> $GITHUB_OUTPUT
        echo "✅ Generated repository name: $REPO_NAME"

    - name: Validate inputs summary
      shell: bash
      run: |
        echo "✅ All inputs validated successfully"
        echo "  Study: ${{ inputs.study_title }}"
        echo "  Lead: ${{ inputs.lead_name }} (@${{ inputs.lead_github }})"
        echo "  Target: ${{ inputs.target_date }}"